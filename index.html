<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Polynomial Anatomy & Synthesis Explorer</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>
  <style>
    :root { --panel-w: 380px; }
    body { margin: 0; font-family: system-ui, sans-serif; background: #f0f2f5; color: #1a1a1b; }
    .wrap { max-width: 1200px; margin: 20px auto; padding: 15px; display: grid; grid-template-columns: 1fr var(--panel-w); gap: 15px; }
    .card { background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 20px; position: relative; }
    canvas { width: 100%; height: 550px; display: block; background: #fff; border: 1px solid #ddd; border-radius: 8px; cursor: crosshair; }
    
    .toggle-slider-btn { position: absolute; top: 30px; right: 30px; padding: 8px 12px; font-size: 12px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; z-index: 10; }
    .toggle-slider-btn.off { background: #95a5a6; }

    h1 { font-size: 18px; margin-top: 0; color: #2c3e50; }
    .control-group { margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #eee; }
    .label-row { display: flex; justify-content: space-between; font-weight: 600; margin-bottom: 8px; font-size: 14px; }
    input[type="range"] { width: 100%; cursor: pointer; }
    input[type="text"] { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; }
    
    .legend-box { margin-top: 10px; padding: 8px; border-radius: 6px; font-weight: bold; font-family: 'Courier New', monospace; display: none; }
    #fDisplay { color: #e67e22; border-left: 5px solid #e67e22; background: #fff5eb; }
    #gDisplay { color: #e74c3c; border-left: 5px solid #e74c3c; background: #fdf2f2; }
    #opDisplay { color: #2ecc71; border-left: 5px solid #2ecc71; background: #f0fff4; font-size: 13px; }

    .checkbox-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
    .info-box { background: #e8f4fd; padding: 12px; border-radius: 8px; font-size: 15px; font-weight: 600; color: #2980b9; margin-top: 10px; }
    button.reset { width: 100%; padding: 12px; background: #e74c3c; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; margin-top: 10px; }
    
    /* Coordinate Tooltip Style */
    #tooltip { position: absolute; background: rgba(0, 0, 0, 0.85); color: white; padding: 10px; border-radius: 6px; font-size: 12px; pointer-events: none; display: none; line-height: 1.4; z-index: 20; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <button id="toggleSlider" class="toggle-slider-btn">Slider Graph: ON</button>
      <canvas id="cv"></canvas>
      <div id="tooltip"></div>
    </div>
    
    <div class="card">
      <h1>Polynomial Explorer</h1>
      
      <div class="control-group">
        <div class="label-row"><span>y = x<sup>n</sup> + x</span> <span>n = <span id="nVal">1.0</span></span></div>
        <input id="nSlider" type="range" min="-3" max="3" step="0.5" value="1" />
      </div>

      <div class="control-group">
        <div class="label-row">Input Polynomial (Enter to add)</div>
        <input id="funcInput" type="text" placeholder="e.g. 2x^2 - 4" />
        <div id="fDisplay" class="legend-box"></div>
        <div id="gDisplay" class="legend-box"></div>
      </div>

      <div class="control-group">
        <div class="label-row">Operations (f vs g)</div>
        <div class="checkbox-grid">
          <label><input type="checkbox" id="checkSum"> Sum (+)</label>
          <label><input type="checkbox" id="checkDiff"> Diff (-)</label>
          <label><input type="checkbox" id="checkProd"> Multi (Ã—)</label>
        </div>
        <div id="opDisplay" class="legend-box"></div>
      </div>

      <div class="info-box" id="eqnDisplay">Slider: y = x^1.0 + x</div>
      <button class="reset" onclick="resetAll()">Reset Explorer</button>
    </div>
  </div>

<script>
  const cv = document.getElementById("cv"), ctx = cv.getContext("2d");
  const nSlider = document.getElementById("nSlider"), funcInput = document.getElementById("funcInput");
  const fBox = document.getElementById("fDisplay"), gBox = document.getElementById("gDisplay"), opBox = document.getElementById("opDisplay");
  const tooltip = document.getElementById("tooltip");
  
  let sliderOn = true;
  let functions = []; 
  let world = { xmin: -6, xmax: 6, ymin: -6, ymax: 6 };
  let mouseX = null;

  function init() {
    cv.width = cv.clientWidth; cv.height = cv.clientHeight;
    update();
  }

  function toScreen(x, y) {
    return { x: (x - world.xmin) / (world.xmax - world.xmin) * cv.width, y: (world.ymax - y) / (world.ymax - world.ymin) * cv.height };
  }

  function toWorld(px, py) {
    return { x: world.xmin + (px / cv.width) * (world.xmax - world.xmin), y: world.ymax - (py / cv.height) * (world.ymax - world.ymin) };
  }

  function drawGrid() {
    ctx.clearRect(0,0,cv.width,cv.height);
    ctx.strokeStyle = "#f0f0f0"; ctx.lineWidth = 1;
    for(let x = world.xmin; x <= world.xmax; x++) { let p = toScreen(x, 0); ctx.beginPath(); ctx.moveTo(p.x, 0); ctx.lineTo(p.x, cv.height); ctx.stroke(); }
    for(let y = world.ymin; y <= world.ymax; y++) { let p = toScreen(0, y); ctx.beginPath(); ctx.moveTo(0, p.y); ctx.lineTo(cv.width, p.y); ctx.stroke(); }
    ctx.strokeStyle = "#999"; ctx.lineWidth = 2; let origin = toScreen(0,0);
    ctx.beginPath(); ctx.moveTo(0, origin.y); ctx.lineTo(cv.width, origin.y); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(origin.x, 0); ctx.lineTo(origin.x, cv.height); ctx.stroke();
    ctx.fillStyle = "#666"; ctx.font = "12px sans-serif";
    for (let x = world.xmin; x <= world.xmax; x++) { if(x!==0) ctx.fillText(x, toScreen(x,0).x - 4, origin.y + 15); }
    for (let y = world.ymin; y <= world.ymax; y++) { if(y!==0) ctx.fillText(y, origin.x - 20, toScreen(0,y).y + 5); }
  }

  function plot(fn, color, width=3) {
    ctx.strokeStyle = color; ctx.lineWidth = width; ctx.beginPath();
    let first = true;
    for(let i=0; i<=cv.width; i++) {
      let x = world.xmin + (i/cv.width)*(world.xmax - world.xmin);
      try {
        let y = fn(x);
        if (isNaN(y) || !isFinite(y)) { first = true; continue; }
        let p = toScreen(x, y);
        if(first) { ctx.moveTo(p.x, p.y); first = false; } else ctx.lineTo(p.x, p.y);
      } catch(e) { first = true; }
    }
    ctx.stroke();
  }

  function update() {
    drawGrid();
    const n = parseFloat(nSlider.value);
    document.getElementById("nVal").innerText = n.toFixed(1);
    document.getElementById("eqnDisplay").innerText = `Slider: y = x^${n.toFixed(1)} + x`;
    
    const sliderFn = (x) => Math.pow(x, n) + x;
    if(sliderOn) plot(sliderFn, "#3498db");

    if(functions[0]) plot(functions[0].fn, "#e67e22");
    if(functions[1]) plot(functions[1].fn, "#e74c3c");

    fBox.style.display = functions[0] ? 'block' : 'none';
    if(functions[0]) fBox.innerText = `f(x) = ${functions[0].raw}`;
    gBox.style.display = functions[1] ? 'block' : 'none';
    if(functions[1]) gBox.innerText = `g(x) = ${functions[1].raw}`;

    let opFn = null, opText = "";
    if(functions.length === 2) {
      const f = functions[0], g = functions[1];
      if(document.getElementById("checkSum").checked) { opText = `(${f.raw}) + (${g.raw})`; opFn = (x) => f.fn(x) + g.fn(x); }
      else if(document.getElementById("checkDiff").checked) { opText = `(${f.raw}) - (${g.raw})`; opFn = (x) => f.fn(x) - g.fn(x); }
      else if(document.getElementById("checkProd").checked) { opText = `(${f.raw}) * (${g.raw})`; opFn = (x) => f.fn(x) * g.fn(x); }
      if(opFn) { opBox.style.display = 'block'; opBox.innerText = `Result: ${opText}`; plot(opFn, "#2ecc71", 5); } else { opBox.style.display = 'none'; }
    } else { opBox.style.display = 'none'; }

    handleHover(sliderFn, opFn);
  }

  function handleHover(sliderFn, opFn) {
    if (mouseX === null) { tooltip.style.display = "none"; return; }
    const worldX = toWorld(mouseX, 0).x;
    const snapX = Math.round(worldX);
    
    if (Math.abs(worldX - snapX) < 0.25) {
      const p = toScreen(snapX, 0);
      ctx.setLineDash([5, 5]); ctx.strokeStyle = "#ccc"; ctx.beginPath(); ctx.moveTo(p.x, 0); ctx.lineTo(p.x, cv.height); ctx.stroke(); ctx.setLineDash([]);
      
      let content = `<b>At x = ${snapX}:</b><br>`;
      if(sliderOn) content += `<span style="color:#3498db">Slider: ${sliderFn(snapX).toFixed(2)}</span><br>`;
      if(functions[0]) content += `<span style="color:#e67e22">f(x): ${functions[0].fn(snapX).toFixed(2)}</span><br>`;
      if(functions[1]) content += `<span style="color:#e74c3c">g(x): ${functions[1].fn(snapX).toFixed(2)}</span><br>`;
      if(opFn) content += `<span style="color:#2ecc71">Op Result: ${opFn(snapX).toFixed(2)}</span>`;
      
      tooltip.style.display = "block";
      tooltip.innerHTML = content;
      tooltip.style.left = (p.x + 15) + "px";
      tooltip.style.top = "50px";
    } else { tooltip.style.display = "none"; }
  }

  cv.addEventListener('mousemove', (e) => { mouseX = e.offsetX; update(); });
  cv.addEventListener('mouseleave', () => { mouseX = null; update(); });

  funcInput.addEventListener('keydown', (e) => {
    if(e.key === 'Enter' && funcInput.value.trim() !== "") {
      try {
        const raw = funcInput.value;
        const fn = (x) => math.evaluate(raw, {x: x});
        if(functions.length >= 2) functions.shift();
        functions.push({raw, fn});
        funcInput.value = ""; update();
      } catch(err) { alert("Syntax Error!"); }
    }
  });

  document.getElementById("toggleSlider").addEventListener('click', function() {
    sliderOn = !sliderOn; this.innerText = `Slider Graph: ${sliderOn ? 'ON' : 'OFF'}`;
    this.className = `toggle-slider-btn ${sliderOn ? '' : 'off'}`; update();
  });

  function resetAll() { functions = []; nSlider.value = 1; document.querySelectorAll('input[type=checkbox]').forEach(c => c.checked = false); update(); }
  nSlider.addEventListener('input', update);
  document.querySelectorAll('input[type=checkbox]').forEach(c => c.addEventListener('change', update));
  window.addEventListener('resize', init);
  init();
</script>
</body>
</html>
